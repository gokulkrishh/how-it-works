{"componentChunkName":"component---src-templates-issue-template-js","path":"/posts/async-await","result":{"data":{"markdownRemark":{"html":"<p><br /><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e1045a42160231f57fe35fdc13ff99c6/b1f81/async-await.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4klEQVQoz42TS28SURiG2ZDIVS4DgRmGmQGEgtxs7cI1O6EsqtHGH2NX3ArduichgfAT+Ak2Adbsq9GYLlwotcLjmWkTUJrYN3nmPTMn83yZ5IxtjcjvFfy4hp9LWP7Cypcr+Cr4/A2uvsP1Df/Ler3GZl42T7ZeEjO4EffLJQ+NJTQXl58uaTSbfOg26Jyd0eq0afe69M4bdHtNmu0OTbHfaDR2aDVbnL4/ZT6fW1JL+PHiAtcjB5qsEgxHeByU8Ae8pJQgejSAy+3G4XLgdDtxely3fYfH58Vms9Hv9zdC0x6LxUik05QOD3l+UKJ4sE85X+aF6NKzLLn9HEY2ifE0hbGXuF3nkqSKaUJymPF4vBHOZjOi0ShGIsFeoUyxmKdQKGAk0+hGUgxTUMVAOSrvoCoxvB4vw+Hwb2EkEkHTdRLZPJlMmoQRR1ZUFCGKyrKFoig7qHEVr/ceofnJhmFg6EkKmSfkkro1XVdVDDWOJjomUP9B0zR8Ph+j0WgjnE6nSCEJORJGC4XQTYIh5ICEIogHQkQCQfx+PwGBfwtJkrDb7QwGg41wsVhQq1V5e3LMybtXvH5zTPXoiGqtZvHyrmv3UK/XqVQqTCaTjdA8kKuVyYqV+GvMxjzwW6wfgJk/CPMnsOVKdrYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"async await illustration\" title=\"async await illustration\" src=\"/static/e1045a42160231f57fe35fdc13ff99c6/fcda8/async-await.png\" srcset=\"/static/e1045a42160231f57fe35fdc13ff99c6/12f09/async-await.png 148w,\n/static/e1045a42160231f57fe35fdc13ff99c6/e4a3f/async-await.png 295w,\n/static/e1045a42160231f57fe35fdc13ff99c6/fcda8/async-await.png 590w,\n/static/e1045a42160231f57fe35fdc13ff99c6/efc66/async-await.png 885w,\n/static/e1045a42160231f57fe35fdc13ff99c6/c83ae/async-await.png 1180w,\n/static/e1045a42160231f57fe35fdc13ff99c6/b1f81/async-await.png 6078w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span><br /></p>\n<p>Before async await, we used <strong>promises</strong> and <strong>callbacks</strong> to handle the <strong>asynchronous code</strong> in javascript. While working with <strong>promises</strong> and <strong>callbacks</strong> you might have heard a term called <strong>callback hell</strong>. In simple terms, it happens when our code has too many nested <strong>callbacks</strong>.</p>\n<p>To solve the callback hell, a new feature was introduced in <strong>ECMAScript 8</strong> (2017) called <code class=\"language-text\">async await</code>. Async await is a new way to write <strong>asynchronous code</strong> in <strong>javascript</strong>.</p>\n<p>So what is async await and how does it work?</p>\n<h4>1. async</h4>\n<p>To create an <code class=\"language-text\">async</code> function, <strong>async</strong> keyword should be added in front of <strong>function</strong> keyword.</p>\n<p><strong>Few points to remember:</strong></p>\n<ul>\n<li>When an <code class=\"language-text\">async</code> function is called, it returns a <strong>promise</strong>. If the returned value is not a promise, then <code class=\"language-text\">async</code> will <strong>wrap it in promise</strong> and <strong>return it</strong>.</li>\n<li><strong>Throwing an exception</strong> in async function is equal to <strong>rejecting</strong> a promise.</li>\n</ul>\n<p><strong>Example</strong>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber 0\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">say</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>  <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// To handle success &amp; failure</span>\n<span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>console<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">)</span> <span class=\"token comment\">// success</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>console<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// failure</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4>2. await</h4>\n<p><code class=\"language-text\">await</code> keyword can only be used inside <code class=\"language-text\">async</code> function, except for the <a href=\"https://v8.dev/features/top-level-await\">top-level await</a>.</p>\n<p><strong>Few points to remember:</strong></p>\n<ul>\n<li><code class=\"language-text\">await</code> keyword allow us to wait <strong>synchronously</strong> on an <strong>asynchronous code</strong>.</li>\n<li>Can be used with <strong>try/catch</strong> statement to handle success and failure.</li>\n<li><strong>Less boilerplate</strong> code compared to promise with callbacks.</li>\n</ul>\n<p><strong>Example</strong>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber 0\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchPokemon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> pokemon1 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://pokeapi.co/api/v2/pokemon/1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> pokemon2 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://pokeapi.co/api/v2/pokemon/2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> response1 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> pokemon1<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> response2 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> pokemon2<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response1<span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> response2<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">fetchPokemon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// logs \"bulbasaur ivysaur\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Async await works as if the code were <strong>synchronous</strong>, but <strong>without blocking</strong> the main thread. Read my previous post to understand more about main thread and <a href=\"/posts/event-loop\">event loop</a>.</p>\n<p>Let's see the same example using promise based <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\">fetch</a> API.</p>\n<p><strong>Example</strong>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber 0\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">fetchPokemon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://pokeapi.co/api/v2/pokemon/1\"</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response1</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> response1<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response1</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://pokeapi.co/api/v2/pokemon/2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response2</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token keyword\">return</span> response2</span><span class=\"gatsby-highlight-code-line\">            <span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response2</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">              console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response1<span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> response2<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">              console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Fetch pokemon</span>\n<span class=\"token function\">fetchPokemon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// logs \"bulbasaur ivysaur\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The above code works as expected but it is <strong>hard to debug</strong> and becomes a <strong>non-maintainable code</strong> if we want to modify or extend the function.</p>\n<p><strong>Below gif explains async await in 7 seconds</strong>:</p>\n<blockquote class=\"twitter-tweet\" data-dnt=\"true\"><p lang=\"en\" dir=\"ltr\">understanding async/await in 7 seconds <a href=\"https://t.co/IJOQJ2DR35\">pic.twitter.com/IJOQJ2DR35</a></p>&mdash; wassim.dev (@manekinekko) <a href=\"https://twitter.com/manekinekko/status/855824609299636230?ref_src=twsrc%5Etfw\">April 22, 2017</a></blockquote>\n\n<p>Some <strong>disadvantages</strong> of async await.</p>\n<p><strong>Disadvantages</strong>:</p>\n<ul>\n<li>We cannot do <strong>multiple await</strong> in the same line. There is no way to run <strong>multiple async</strong> operations <strong>simultaneously</strong>. But the same can be done in normal promises using <code class=\"language-text\">promise.all()</code>.</li>\n<li>If we are supporting old browsers then <a href=\"https://babeljs.io/\">babel</a> will transpile and <strong>bloat</strong> the <a href=\"https://babeljs.io/repl#?browsers=&#x26;build=&#x26;builtIns=false&#x26;spec=false&#x26;loose=false&#x26;code_lz=IYZwngdgxgBAZgV2gFwJYHsLwKbKgCwAV0BrbAW0wAoBKGAbwCgYZkAnMB5lmKTEZDAAOpCphgBeGMADuwVILi4CVAET5kyISABcAej0iywIagB0fPSdR6AbgCZDoyhD0BGVTQDc3Fnwgg6AA22GZB6ADmVLLygkZiEGYAVoEQtN7cAL68wHj4MFTYbGzobHRMPLz8waHhUUUlZT4smYytjEp5xGQutF4wBjB1IDCqAEYIQWOgwAhsqoxAA&#x26;debug=false&#x26;forceAllTransforms=false&#x26;shippedProposals=true&#x26;circleciRepo=&#x26;evaluate=true&#x26;fileSize=true&#x26;timeTravel=false&#x26;sourceType=script&#x26;lineWrap=true&#x26;presets=env%2Cenv&#x26;prettier=true&#x26;targets=&#x26;version=7.9.6&#x26;externalPlugins=\">code</a>.</li>\n</ul>\n<p><strong>Fun fact:</strong></p>\n<blockquote> Async await is a syntactic sugar built on top of promises.</blockquote>\n<p>If you know javascript well then you might have already guessed that <code class=\"language-text\">await</code> calls <code class=\"language-text\">then()</code> method under the hood. Now you know why <strong>await only works with async</strong> functions.</p>\n<p><strong>Example:</strong></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber 0\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">customThenFunz</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token function-variable function\">then</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// resolve &amp; reject are promise callback's</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">customThenFunz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// logs \"hello\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In the above example, await calls the <code class=\"language-text\">then()</code> method returned by the <strong>customThenFunz</strong> function. One more point to remember is <code class=\"language-text\">async await</code> uses <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*\">generators</a> internally to <strong>pause</strong> and <strong>resume</strong> execution of the code.</p>\n<p>Now we will write the above example using <strong>generators &#x26; promises</strong> to help us to understand how async await would be been implemented internally.</p>\n<p>Before I proceed with implementation, let's try to understand the basics of <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*\">generators</a>.</p>\n<ul>\n<li>To create a generator function, <code class=\"language-text\">function</code> keyword should have a <code class=\"language-text\">*</code> (asterisk symbol) following it.</li>\n<li>A generator function returns a <strong>generator object</strong>.</li>\n<li>A generator object follows the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols\">iterable protocol</a>.</li>\n<li><code class=\"language-text\">yield</code> keyword is used to <strong>pause</strong> and <strong>un-pause</strong> the code.</li>\n<li><code class=\"language-text\">next()</code> method in a way to tell to go to <strong>next iteration</strong>.</li>\n<li>Upon calling <code class=\"language-text\">next()</code> method, it returns a object with <code class=\"language-text\">value</code> and status called <code class=\"language-text\">done</code> (true or false).</li>\n<li><code class=\"language-text\">throw()</code> method in generator object <strong>resumes execution</strong> by <strong>throwing an error</strong> and returns an object with <code class=\"language-text\">value</code> and <code class=\"language-text\">done</code>.</li>\n</ul>\n<p><strong>Example:</strong></p>\n<p>A simple counter function to return the count until maxCount is reached.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber 0\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">counter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">maxCount</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>  <span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">&lt;=</span> maxCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">yield</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> iterator <span class=\"token operator\">=</span> <span class=\"token function\">counter</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// logs {value: 1, done: false}</span></span><span class=\"gatsby-highlight-code-line\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// logs {value: 2, done: false}</span></span><span class=\"gatsby-highlight-code-line\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// logs {value: undefined, done: true}</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now we understood how generator function in javascript works, lets write our custom async await function.</p>\n<p><strong>To emulate async await we need to do the following:</strong></p>\n<ul>\n<li>Should be able to <strong>synchronously</strong> wait <strong>without blocking</strong> the main thread.</li>\n<li>Should be able to <strong>halt</strong> and <strong>resume</strong> the execution.</li>\n<li>Should be able to <strong>return the value</strong> once done. (Eg: fetch api or just a number or promise based object)</li>\n<li>Should <strong>throw an error</strong> If it <strong>fails</strong>.</li>\n</ul>\n<p>We will name our custom function as <code class=\"language-text\">customAsyncAwait</code>. Input for <code class=\"language-text\">customAsyncAwait</code> function will be a <strong>generator</strong> function. Inside our customAsyncAwait function, we will create a <strong>generator object</strong> by calling the <strong>input</strong> when the <strong>customAsyncAwait</strong> function is invoked. A function called <code class=\"language-text\">resolver()</code> is used to handle <strong>iteration</strong> of the generator function which will be called <strong>recursively</strong> by passing the <strong>iterator object</strong> as an <strong>input</strong>. If the iteration is <strong>done</strong>, then <strong>resolve</strong> and <strong>return</strong> the value. If it <strong>fails</strong> throw an error which in turn <strong>resolves</strong> and <strong>return</strong> the error.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber 0\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">customAsyncAwait</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">generatorFunz</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// create generator object</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> generatorObj <span class=\"token operator\">=</span> <span class=\"token function\">generatorFunz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">resolver</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">currentIteration</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If the iterator object is done then return the value</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>currentIteration<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>currentIteration<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>currentIteration<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolver</span><span class=\"token punctuation\">(</span>generatorObj<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// proceed with next iteration in generator</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolver</span><span class=\"token punctuation\">(</span>generatorObj<span class=\"token punctuation\">.</span><span class=\"token function\">throw</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// throw an error</span></span>    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">return</span> <span class=\"token function\">resolver</span><span class=\"token punctuation\">(</span>generatorObj<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Start the iteration</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Fetch based generator</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">fetchPokemonGenerator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> pokemon1 <span class=\"token operator\">=</span> <span class=\"token keyword\">yield</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://pokeapi.co/api/v2/pokemon/1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> pokemon2 <span class=\"token operator\">=</span> <span class=\"token keyword\">yield</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://pokeapi.co/api/v2/pokemon/2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> response1 <span class=\"token operator\">=</span> <span class=\"token keyword\">yield</span> pokemon1<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> response2 <span class=\"token operator\">=</span> <span class=\"token keyword\">yield</span> pokemon2<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response1<span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> response2<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Call our custom async function</span>\n<span class=\"token function\">customAsyncAwait</span><span class=\"token punctuation\">(</span>fetchPokemonGenerator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// logs \"bulbasaur ivysaur\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3><a href=\"https://codesandbox.io/embed/custom-async-await-using-generators-ugl7z?expanddevtools=1&#x26;fontsize=14&#x26;hidenavigation=1&#x26;module=%2Fsrc%2Findex.js&#x26;theme=dark\">Demo</a></h3>\n<iframe\n  src=\"https://codesandbox.io/embed/custom-async-await-using-generators-ugl7z?expanddevtools=1&fontsize=14&hidenavigation=1&module=%2Fsrc%2Findex.js&theme=dark\"\n  style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\"\n  title=\"custom async await using generators\"\n  allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr\"\n  sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\n></iframe>\n<h4>Final thoughts</h4>\n<p>Async await is an interesting topic and powerful feature in javascript. It helps us to write the <strong>asynchronous code</strong> more <strong>readable</strong> and <strong>maintainable</strong>. I hope in this post you have learned a little bit more about javascript. The custom async await function I wrote might not be how async await would have been implemented but you get the idea right how it works?.</p>\n<p>Post a comment below if you have any questions. If you like the post share it.</p>\n<p>Thanks for reading till the end :)</p>\n<p>Follow me on <a href=\"https://twitter.com/gokul_i\">twitter</a> for more web related things.</p>\n<h4>References:</h4>\n<ul>\n<li><a href=\"https://tc39.es/ecma262/#sec-async-function-definitions\">async await specification</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await\">async await</a></li>\n</ul>","frontmatter":{"date":"May 12, 2020","path":"/posts/async-await","published":true,"title":"Async await","description":"Async await is a new way to write asynchronous code in javascript.","tags":["javascript","es8"]}}},"pageContext":{}},"staticQueryHashes":["2272393477","3649515864"]}