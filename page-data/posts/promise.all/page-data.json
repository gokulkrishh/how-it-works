{"componentChunkName":"component---src-templates-issue-template-js","path":"/posts/promise.all","result":{"data":{"markdownRemark":{"html":"<p><br /><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/79ae8e112450d7dbef2b07adb6f56a53/9c701/promise.all.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 67.56756756756756%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqElEQVQ4y5WTy08TURjFb5mUVq2ACwVLFAttoUALiUKV0Kd9TR8UrKUFiVE0mgjS6EJASYtQF8b4D2jizn8FV7pQI9CwUZCHEMDwTjpzvDMl0IKYuPjlfDN3vjPfmXuHbC8m0+vzI+mV6eH06nSC6v+xOpMQ+7eoz/bSizTZWR7F+3f34e5gYQwFYPT7YWzxozFANZDRv9UCV4IBGNw+jL66jZ3FEWwuJkG2Fob52GCUJ8VmntG4eaJy8KTMzpMKitrNSzQeXlLh5Ek5pZLlifCM2pVZ09K6sIlvvdXGr/2M85u/kjxZn00gNhiBXOfEOdM1nGkMQtnA4oTBCXm1E4zWCkZjA6O2ZTSL/Eo7SKkZ4bttWP4+BGoIahhH30AU+dqrOHXJBcVFJxR1duTpTCKMzgyislIsh8iroPdLTAh1HzAUJiQX7Ciq80Fa6YC0xgOm2gSJrhlMbTPyaM3om8UXKPQsTuq9kFY5UVDvBSl3IXTnoOFAO12wo9DAQlHL4jhtktW4aSwaqdxyAOsejJrq2UMTJtDX3w6ZIYDzji4U1fsh1blwjE4hp1Nk4lmzyIp8lGHvkzCN1wLl5QikGgeNb95vzJksd8IjDON42E+/odIBmdqR07BvkmWksvzbkJ4fPHrWCUkVC3mtU9w5SYWwg5Zdteai3q+lWpt4bK5nb8rGXIK79zjMkTIvd9oY4Yjaw0n0QU6mb+VItY3SwBGVmZNU+TlSauVIsYkjJWYKVSXVgibO1xXkVn4McdSQIxvzw3jzthuOsA/+Gy3wRP1gqbKdAn64Oj1wRb3wdATgjvjgbPfuIVzbQ168fH0TqzNxbAm/3trcyPjC1NOJqU+xyc9jPakvIg926Ul9HesVEesPAr05pD7GJudSAxO/Z5+Pby8lv/0BkXM2H3X64SwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Promise.all\" title=\"Promise.all\" src=\"/static/79ae8e112450d7dbef2b07adb6f56a53/fcda8/promise.all.png\" srcset=\"/static/79ae8e112450d7dbef2b07adb6f56a53/12f09/promise.all.png 148w,\n/static/79ae8e112450d7dbef2b07adb6f56a53/e4a3f/promise.all.png 295w,\n/static/79ae8e112450d7dbef2b07adb6f56a53/fcda8/promise.all.png 590w,\n/static/79ae8e112450d7dbef2b07adb6f56a53/efc66/promise.all.png 885w,\n/static/79ae8e112450d7dbef2b07adb6f56a53/c83ae/promise.all.png 1180w,\n/static/79ae8e112450d7dbef2b07adb6f56a53/9c701/promise.all.png 1774w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span><br /></p>\n<p>Letâ€™s say we want many promises to execute in parallel and wait until all of them are resolved. Then <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all\">Promise.all</a> is the right candidate which takes an array of promises and returns a new promise.</p>\n<p>Let's understand how <code class=\"language-text\">Promise.all</code> works.</p>\n<p><b>Resolves when:</b></p>\n<ol>\n<li>Promises which will be fulfilled after sometime (Eg: <b>API which fulfills after 10 seconds</b>)</li>\n<li>Promises that have been already fulfilled (Eg: <b>API which fulfils before passing to .all()</b>)</li>\n<li>Non-promises based functions, variables etc, (Eg: <b>Function which returns a value</b>)</li>\n</ol>\n<p><b>Rejects when</b>:</p>\n<ol>\n<li>If one of promise get rejected, then <code class=\"language-text\">Promise.all</code> immediately rejects, completely ignoring about the other ones on the list.</li>\n</ol>\n<p>We are going to see an example of <code class=\"language-text\">Promise.all</code> and then we will implement it.</p>\n<h4>Example:</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* A simple function to sleep for certain time and then resolve it */</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">sleep</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">delay</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Async function</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">asyncFunz</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// await method will wait for 2 seconds and return below string</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">\"Executed after 2 seconds\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Fetch user information */</span>\n<span class=\"token keyword\">var</span> promise2 <span class=\"token operator\">=</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://reqres.in/api/user/1</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* A simple function which add's two numbers and return it */</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">sum</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Adding above methods and some more to Promise.all method */</span>\n<span class=\"token keyword\">var</span> myPromises <span class=\"token operator\">=</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token function\">asyncFunz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  promise2<span class=\"token punctuation\">,</span>\n  <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Attaching .then, .catch methods to handle Promise.all */</span>\nmyPromises\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resolved: \"</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rejected: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Above Promise.all resolves and log the result (Below line for result)</span>\n<span class=\"token comment\">// resolved: [\"Executed after 2 seconds\", {data: {...}}, 3, undefined, null, 1]</span></code></pre></div>\n<p>In the above example, <code class=\"language-text\">asyncFunz</code>, <code class=\"language-text\">promise2</code> are actual <code class=\"language-text\">async functions</code> and the rest of items in the array are a normal function, undefined, null and 1.</p>\n<p>From above example we can understand that <code class=\"language-text\">Promise.all</code> method accepts both <code class=\"language-text\">async</code> and <code class=\"language-text\">non-async</code> items, functions, variables etc,.</p>\n<h4>To write our custom <b>promise.all()</b> function, we are going follow <code class=\"language-text\">3 steps</code>.</h4>\n<h4>Step 1:</h4>\n<ul>\n<li>Create a function called <b>promiseAll</b> which accepts a parameter called <code class=\"language-text\">promisesArr</code>.</li>\n<li>This function will have two variables: <b>result</b> (Type: Array) &#x26; <b>counter</b> (Type: Number).</li>\n<li><code class=\"language-text\">result</code> variable is to store the result of items in <code class=\"language-text\">promisesArr</code>.</li>\n<li><code class=\"language-text\">counter</code> variable to keep the count of how many items resolved so far in <code class=\"language-text\">promisesArr</code>.</li>\n<li>Finally, add <code class=\"language-text\">Promise</code> object to <code class=\"language-text\">resolve/reject</code> and return it (<code class=\"language-text\">More info on step 2</code>).</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* Promise.all() custom function */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">promiseAll</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">promisesArr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* To keep the result of resolved promises */</span>\n  <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span>promisesArr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* To keep track of how many promise got resolved */</span>\n  <span class=\"token keyword\">var</span> counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* To resolve/reject based on promisesArr items */</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Step 2:</h4>\n<ul>\n<li>Iterate the given <b>promisesArr</b> inside <code class=\"language-text\">new Promise()</code> object so we can either catch or resolve the items at each iteration.</li>\n<li>Each item from <code class=\"language-text\">promisesArr</code> is passed to <code class=\"language-text\">Promise.resolve()</code> method to handle both <code class=\"language-text\">promise</code> &#x26; <code class=\"language-text\">non-promise</code> items</li>\n<li>Add <b>.then()</b> &#x26; <b>.catch()</b> chaining methods to <code class=\"language-text\">Promise.resolve()</code> method to handle when the items <code class=\"language-text\">settles</code> in each iteration.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">promiseAll</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">promisesArr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* To keep the result of resolved promises */</span>\n  <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span>promisesArr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* To keep track of how many promise got resolved */</span>\n  <span class=\"token keyword\">var</span> counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* To resolve/reject based on promisesArr items */</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Iterating the given promises array</span>\n    promisesArr<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">promise<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// To handle both promise &amp; non-promise in each iteration</span>\n      Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// Store the result</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// If there is an error, reject it immediately</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Step 3: (Final)</h4>\n<ul>\n<li>When the <code class=\"language-text\">Promise.resolve()</code> resolves, increment counter + 1.</li>\n<li>Store the resolved item in <code class=\"language-text\">result</code> variable in the respective index. So that we can maintain the order of result.</li>\n<li>If the <code class=\"language-text\">counter length</code> === <b>promisesArr</b> length, then resolve the promise.</li>\n<li>If even one item in <code class=\"language-text\">promiseArr</code> is rejected, then discard result and reject the outer promise.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">promiseAll</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">promisesArr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* To keep the result of resolved promises */</span>\n  <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span>promisesArr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* To keep track of how many promise got resolved */</span>\n  <span class=\"token keyword\">var</span> counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* To resolve/reject based on promisesArr items */</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Iterating the given promises array</span>\n    promisesArr<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">promise<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// We need to resolve each item in promises so that even if there is non-promise item we can handle it</span>\n      Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          counter <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Update the counter</span>\n          result<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> item<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Store the result in the same order as given</span>\n\n          <span class=\"token comment\">/* If counter is equal to promises.length then all promises are fulfilled */</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>counter <span class=\"token operator\">===</span> promisesArr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// All promises resolved so resolve outer promise</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// If there is an error, reject the outer promise immediately</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3><a href=\"https://codesandbox.io/embed/promiseall-implementation-n9dlu?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark\">Demo</a></h3>\n<h3>Wrapping up</h3>\n<p>Above piece of code may not be same as how browser vendors would have implemented <b>Promise.all()</b> method, but you get the idea right how it works?.</p>\n<p>I hope this post was useful and we all have learned something new. See you in my next post.</p>\n<p>My next post will be about how to write <code class=\"language-text\">custom spread operator</code> and how it works. If you are not subscribed, subscribe below :D</p>\n<hr />\n<h4>References:</h4>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all\">MDN</a></li>\n<li><a href=\"https://tc39.es/ecma262/#sec-promise.all\">Promise.all() TC39 specification</a></li>\n</ul>","frontmatter":{"date":"February 25, 2020","path":"/posts/promise.all","published":true,"title":"Promise.all","description":"Say we want many promises to execute in parallel and wait until all of them are resolved. Then Promise.all() is our candidate.","tags":["javascript","promises","es6"]}}},"pageContext":{}},"staticQueryHashes":["2272393477","3649515864"]}