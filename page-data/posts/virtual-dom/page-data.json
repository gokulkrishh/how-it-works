{"componentChunkName":"component---src-templates-issue-template-js","path":"/posts/virtual-dom","result":{"data":{"markdownRemark":{"html":"<p><br /><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f2b240bdd490d3ddf4a214865abbd501/913b9/virtual-dom.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB1ElEQVQoz52Ty27TQBSGnbakTV1CbI/jpATkmfE4KXEgGyBcNkgIxEtACxt2SEi8AkJQ8QrtIoEiEQqPBhRxUTQ/Z2aCRRuJBYvPZ8aWP/9ndOwdTcTs2xs5w1TMcEj103/wQc7+eDy64OtE4P0zidePJV7u8ONs/wXtX+2Ikt2HAs/vC+w9EfhxIHE0kTBC/Xks9K1LmfbOKF3xpa6s07rm6pKvbK1Q9cz9akpwxyrhpbpQXP96JzWl1C7hWOLuiKPOttA5XyBpdxFEAlEzA0sU4laOOMntuh6kJUGUYmU9xY2LHCSkhAJzocCdq5KEOdqdC2h1Bmhu9hG3txDGuYUlXbdu5vZ+ECv6oMJao4ubwww/D0TZshNeESQUaLbphc3CYqRGcjqgZ6G0lGuqDepi2Re4NjAJTwhvX5bwA0XCnk0Qt3poMGWJKJ1NZFJSQlOZJcdqXWFUpIst3xvRmSUSZ8/1qO2+PccolmB0jo2ILxJyhIyjusEXz/ALCa8PKe5GBp8VqLEhauEAFT/HEuGd4vBW0kWqhJeinx0Tut7HTwVe0KztPqJZo/kyuDlMy/1J7Bw+ENinOfz+di40MiPFVIL+lDnC1Y9zDv+BeT51MtPtb/KjpYxDDo27AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Virtual DOM\" title=\"Virtual DOM\" src=\"/static/f2b240bdd490d3ddf4a214865abbd501/fcda8/virtual-dom.png\" srcset=\"/static/f2b240bdd490d3ddf4a214865abbd501/12f09/virtual-dom.png 148w,\n/static/f2b240bdd490d3ddf4a214865abbd501/e4a3f/virtual-dom.png 295w,\n/static/f2b240bdd490d3ddf4a214865abbd501/fcda8/virtual-dom.png 590w,\n/static/f2b240bdd490d3ddf4a214865abbd501/efc66/virtual-dom.png 885w,\n/static/f2b240bdd490d3ddf4a214865abbd501/c83ae/virtual-dom.png 1180w,\n/static/f2b240bdd490d3ddf4a214865abbd501/913b9/virtual-dom.png 1822w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span><br /></p>\n<h3>What is Virtual DOM?</h3>\n<p>Virtual DOM otherwise known as <strong>VDOM</strong>, is a <strong>virtual representation</strong> of actual <a href=\"https://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/introduction.html\">DOM</a> (Document Object Model) in the browser. VDOM is kept in <strong>memory</strong> and <strong>synced</strong> with actual DOM.</p>\n<p>Before getting into coding, let's see some advantages and disadvantages.</p>\n<p><strong>Advantages:</strong></p>\n<ul>\n<li>VDOM is useful when we want to <strong>update the DOM</strong> with <strong>minimal operations</strong>.</li>\n<li>Provides <strong>great performance</strong> over actual DOM when <strong>accessing</strong> and <strong>updating</strong> nodes <strong>frequently</strong>.</li>\n</ul>\n<p><strong>Dis-Advantages:</strong></p>\n<ul>\n<li>Have to <strong>keep track of changes</strong> happening throughout the application.</li>\n<li>Takes <strong>more memory</strong> if not <strong>efficiently</strong> handled.</li>\n</ul>\n<p><strong>üëâüèªNote</strong>: <a href=\"https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_shadow_DOM\">Shadow DOM</a> and <a href=\"https://reactjs.org/docs/faq-internals.html\">Virtual DOM</a> are not the same.</p>\n<h4>Popular Libraries using VDOM:</h4>\n<ul>\n<li><a href=\"https://reactjs.org/\">ReactJS</a></li>\n<li><a href=\"https://reactjs.org/\">PreactJS</a></li>\n<li><a href=\"https://vuejs.org/\">VueJS</a></li>\n</ul>\n<p>We will not look into any of the above libraries and their <strong>VDOM implementations</strong>. This post is about how a virtual DOM works (<strong>More of a simplified version</strong>).</p>\n<p>First lets see an example of HTML representation.</p>\n<h4>Example: index.html</h4>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>Home<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h4>Representation of above HTML: DOM &#x26; VDOM</h4>\n<p><strong>DOM</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">‚îú‚îÄ‚îÄ <span class=\"token constant\">DIV</span><span class=\"token punctuation\">.</span>container\n ‚îú‚îÄ‚îÄ <span class=\"token constant\">H1</span>\n ‚îú‚îÄ‚îÄ #Home</code></pre></div>\n<p><strong>VDOM</strong>: Plain object</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> VDOMTree <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token string\">\"div\"</span><span class=\"token punctuation\">,</span>\n  attributes<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">\"container\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">\"h1\"</span><span class=\"token punctuation\">,</span>\n      attributes<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Home\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Functionality</strong> of a virtual DOM is</p>\n<ol>\n<li>An <strong>object</strong> to store the representation of actual DOM.</li>\n<li><strong>create</strong> element tree.</li>\n<li><strong>diff</strong> the changes of new &#x26; old VDOM trees.</li>\n<li><strong>render</strong> the VDOM tree in DOM.</li>\n</ol>\n<p><strong>Code</strong>: skeleton of <strong>VDOM.js</strong> file</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Plain object to store DOM representation</span>\n<span class=\"token keyword\">var</span> tree <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// To create DOM node with its attributes &amp; children up to 'N' level</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// To diff the changes of old tree &amp; new tree and update the tree</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">diff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// To render VDOM tree in DOM</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Step 1: Create Element</h4>\n<p>Create element function will accept <strong>3 parameters</strong>.</p>\n<ol>\n<li><strong>type</strong> of a node.</li>\n<li><strong>attributes</strong> of a node.</li>\n<li><strong>children</strong> for node.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">type<span class=\"token punctuation\">,</span> attributes<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>children</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> type<span class=\"token punctuation\">,</span> attributes<span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> tree <span class=\"token operator\">=</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"ul\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">\"list\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"li\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"my list 1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"li\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"my list 2\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Result is below</span>\n\n<span class=\"token comment\">/*\n{\n  \"type\": \"ul\",\n  \"attributes\": {\n    \"className\": \"list\"\n  },\n  \"children\": [\n    {\n      \"type\": \"li\",\n      \"attributes\": {},\n      \"children\": [\n        \"my list 1\"\n      ]\n    },\n    {\n      \"type\": \"li\",\n      \"attributes\": {},\n      \"children\": [\n        \"my list 2\"\n      ]\n    }\n  ]\n}\n*/</span></code></pre></div>\n<h4>Step 2: Diff changes</h4>\n<p>To compare changes in VDOM, we need a <strong>diffing algorithm</strong>. For that, we will take basic principles of react <a href=\"https://reactjs.org/docs/reconciliation.html\">reconciliation</a> diffing algorithm.</p>\n<p>React implements a heuristic O(n) algorithm based on the following assumptions.</p>\n<p><strong>Algorithm:</strong></p>\n<ol>\n<li>First <strong>compare</strong> the <strong>two root elements</strong> of <strong>new</strong> &#x26; <strong>old</strong> VDOM tree.</li>\n<li>If the <strong>root elements</strong> are <strong>different</strong>, <strong>ignore</strong> the <strong>old VDOM</strong> tree and use the <strong>new VDOM</strong> tree.</li>\n<li>When comparing the same <strong>element types</strong> in VDOM tree, <strong>only update</strong> whatever has <strong>changed</strong> (Eg: class or text, etc,).</li>\n<li>Go up to <code class=\"language-text\">&#39;N&#39;</code> and repeat the steps <code class=\"language-text\">1 to 3</code>.</li>\n</ol>\n<p>Breaking our <strong>diff()</strong> function in <strong>three parts</strong> for better understanding.</p>\n<ol>\n<li><strong>Diff</strong> the node <strong>type</strong>.</li>\n<li><strong>Diff</strong> the node <strong>attributes</strong>.</li>\n<li><strong>Diff</strong> the node <strong>children</strong>.</li>\n</ol>\n<p><strong>Code:</strong> diff, diffAttributes, diffChildren</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">diff</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldTree<span class=\"token punctuation\">,</span> newTree</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// If new tree is not present return empty array</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>newTree<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Compare two root tree type</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldTree<span class=\"token punctuation\">.</span>type <span class=\"token operator\">!==</span> newTree<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// if not equal ignore the old tree &amp; return new tree</span>\n    <span class=\"token keyword\">return</span> newTree<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// If old &amp; new tree are equal return old tree</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldTree <span class=\"token operator\">===</span> newTree<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> oldTree<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// If old &amp; new tree is of type string, then it's a next node so return new tree</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> oldTree <span class=\"token operator\">===</span> <span class=\"token string\">\"string\"</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">typeof</span> newTree <span class=\"token operator\">===</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> newTree<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">var</span> updatedTree <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>oldTree <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// To store our updated tree</span>\n\n  <span class=\"token comment\">// If both tree types are equal, then start diffing attributes &amp; its children</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldTree<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> newTree<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// DIff attributes (props)</span>\n    <span class=\"token keyword\">var</span> patchAttributes <span class=\"token operator\">=</span> <span class=\"token function\">diffAttributes</span><span class=\"token punctuation\">(</span>\n      oldTree<span class=\"token punctuation\">.</span>attributes<span class=\"token punctuation\">,</span>\n      newTree<span class=\"token punctuation\">.</span>attributes\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If there is diff in attributes then update it</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>patchAttributes<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      updatedTree<span class=\"token punctuation\">.</span>attributes <span class=\"token operator\">=</span> patchAttributes<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Diff children of both trees</span>\n    <span class=\"token keyword\">var</span> patchChildren <span class=\"token operator\">=</span> <span class=\"token function\">diffChildren</span><span class=\"token punctuation\">(</span>oldTree<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">,</span> newTree<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If there is diff in children element then update it</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>patchChildren<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      updatedTree<span class=\"token punctuation\">.</span>children <span class=\"token operator\">=</span> patchChildren<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> updatedTree<span class=\"token punctuation\">;</span> <span class=\"token comment\">// return the updated tree</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// To compare old &amp; new tree children</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">diffChildren</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldTreeChildren<span class=\"token punctuation\">,</span> newTreeChildren</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> updatedChildren <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// To store our updated children</span>\n\n  <span class=\"token keyword\">var</span> oldTreeChildrenLength <span class=\"token operator\">=</span> oldTreeChildren<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> newTreeChildrenLength <span class=\"token operator\">=</span> newTreeChildren<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Calculating length iterate the children</span>\n  <span class=\"token keyword\">var</span> length <span class=\"token operator\">=</span>\n    oldTreeChildrenLength <span class=\"token operator\">></span> newTreeChildrenLength\n      <span class=\"token operator\">?</span> oldTreeChildrenLength\n      <span class=\"token operator\">:</span> newTreeChildrenLength<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Iterate the children node tree</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> leftNode <span class=\"token operator\">=</span> oldTreeChildren<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> rightNode <span class=\"token operator\">=</span> newTreeChildren<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If leftNode is not present &amp; rightNode is present</span>\n    <span class=\"token comment\">// That means new children is present in new tree children</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>leftNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rightNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        updatedChildren<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>rightNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Add new children</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// Else recursively traverse the tree children and diff it</span>\n    <span class=\"token comment\">// Up to 'N' of trees</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      updatedChildren <span class=\"token operator\">=</span> updatedChildren<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span>leftNode<span class=\"token punctuation\">,</span> rightNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> updatedChildren<span class=\"token punctuation\">;</span> <span class=\"token comment\">// return the updated children</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// To compare old &amp; new tree attributes</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">diffAttributes</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldTreeAttrs<span class=\"token punctuation\">,</span> newTreeAttrs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> updatedAttributes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// To store attributes</span>\n\n  <span class=\"token comment\">// If old tree attributes are not present return new tree attributes</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>oldTreeAttrs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> newTreeAttrs<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Start iterating tree attributes</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> oldTreeAttrKey <span class=\"token keyword\">in</span> oldTreeAttrs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// oldTree key is not in new tree attributes, remove it</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>oldTreeAttrKey <span class=\"token keyword\">in</span> newTreeAttrs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      updatedAttributes<span class=\"token punctuation\">[</span>oldTreeAttrKey<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">var</span> oldTreeAttrValue <span class=\"token operator\">=</span> oldTreeAttrs<span class=\"token punctuation\">[</span>oldTreeAttrKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// value of old tree attribute</span>\n    <span class=\"token keyword\">var</span> newTreeAttrValue <span class=\"token operator\">=</span> newTreeAttrs<span class=\"token punctuation\">[</span>oldTreeAttrKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// value of new tree attribute</span>\n\n    <span class=\"token comment\">// If value of old and new attributes are same continue the iteration</span>\n    <span class=\"token comment\">// else update value of new tree attribute</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldTreeAttrValue <span class=\"token operator\">===</span> newTreeAttrValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      updatedAttributes<span class=\"token punctuation\">[</span>oldTreeAttrKey<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> newTreeAttrValue<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Again start iterating new tree attributes to see if there any new attribute available</span>\n  <span class=\"token comment\">// which is not present in old tree attributes</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> newTreeKey <span class=\"token keyword\">in</span> newTreeAttrs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If new tree attribute is not present in old tree attributes</span>\n    <span class=\"token comment\">// then add that attribute it</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>newTreeKey <span class=\"token keyword\">in</span> oldTreeAttrs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      updatedAttributes<span class=\"token punctuation\">[</span>newTreeKey<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> newTreeAttrs<span class=\"token punctuation\">[</span>newTreeKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> updatedAttributes<span class=\"token punctuation\">;</span> <span class=\"token comment\">// return updated attributes</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Example old tree</span>\n<span class=\"token keyword\">var</span> oldTree <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token string\">\"ul\"</span><span class=\"token punctuation\">,</span>\n  attributes<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">\"list\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">,</span> children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"My list 1\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">,</span> children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"My list 2\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Example new tree</span>\n<span class=\"token keyword\">var</span> newTree <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  type<span class=\"token operator\">:</span> <span class=\"token string\">\"ul\"</span><span class=\"token punctuation\">,</span>\n  attributes<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">\"list\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">\"li\"</span><span class=\"token punctuation\">,</span>\n      attributes<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token string\">\"my-list-2\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// new</span>\n      children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"My list 2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"simple text\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// new</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> updatedTree <span class=\"token operator\">=</span> <span class=\"token function\">diff</span><span class=\"token punctuation\">(</span>oldTree<span class=\"token punctuation\">,</span> newTree<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>updatedTree<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Result is below</span>\n\n<span class=\"token comment\">/*\n{\n  \"type\": \"ul\",\n  \"attributes\": {},\n  \"children\": [\n    {\n      \"type\": \"li\",\n      \"children\": [\n        \"My list 2\"\n      ],\n      \"attributes\": {\n        \"id\": \"my-list-2\"\n      }\n    },\n    \"simple text\"\n  ]\n}\n*/</span></code></pre></div>\n<p>The above code is a little big, but I have commented on each and every line to understand better. So, I will skip explaining it.</p>\n<h4>Step 3: Render the VDOM tree in DOM</h4>\n<p>Job of the <code class=\"language-text\">render()</code> function is to <strong>create/update/patch</strong> the changes to <strong>DOM elements</strong> based on the <strong>diff'ed tree</strong> and render everything into DOM.</p>\n<p><strong>Implementation details</strong>:</p>\n<ul>\n<li>If <strong>DOM element</strong> is already present, use it else create a <strong>DOM element</strong>.</li>\n<li><strong>Diff</strong> the <strong>attributes</strong> (props), if not present set the attributes else update it (Eg: <strong>class</strong> or <strong>id</strong>).</li>\n<li><strong>Diff</strong> the <strong>children nodes</strong> by iterating <strong>recursively</strong> up to 'N' level.</li>\n<li><strong>Render</strong> the DOM.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tree<span class=\"token punctuation\">,</span> renderTo</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// I am going to leave the function of render to you ;)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> tree <span class=\"token operator\">=</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"ul\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> className<span class=\"token operator\">:</span> <span class=\"token string\">\"list\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"li\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"my list 1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"li\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"my list 2\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// render's the HTML in DOM</span></code></pre></div>\n<h4>Summing up</h4>\n<p>I tried my best to explain <strong>how a virtual DOM works</strong>. The implementation might not be like <strong>preact</strong>, <strong>react</strong> would have implemented and theirs will be <strong>far better</strong> and <strong>more performant</strong> in nature. But you get the idea right. How a virtual DOM works?</p>\n<p>For the sake of this post, I have left our lot of implementation, hope this post was helpful in understanding <strong>little more</strong> about <strong>virtual dom</strong>.</p>\n<p>By the way <a href=\"https://github.com/developit\">Jason Miller</a>, creator of <strong>preact</strong> has created a tiny <strong>480Byte</strong> <a href=\"https://gist.github.com/developit/2038b141b31287faa663f410b6649a87\">VDOM library</a>. Check it out.</p>\n<p>Thanks for reading it so far üòÅ. My next post will be about <strong>Promise.allSettled()</strong>. See you next Tuesday :)</p>\n<hr />\n<h4>References:</h4>\n<ul>\n<li><a href=\"https://codepen.io/sdras/full/RwwQapa\">How does the Virtual DOM work</a> animation.</li>\n<li><a href=\"https://reactjs.org/docs/faq-internals.html\">React VDOM</a>.</li>\n<li><a href=\"https://reactjs.org/docs/reconciliation.html\">Reconciliation</a>.</li>\n<li><a href=\"https://wiki.c2.com/?DiffAlgorithm\">Diff Algorithm</a>.</li>\n</ul>","frontmatter":{"date":"March 10, 2020","path":"/posts/virtual-dom","published":true,"title":"Virtual DOM","description":"Virtual DOM otherwise known as VDOM, is a virtual representation of actual DOM (Document Object Model) in the browser.","tags":["javascript","react"]}}},"pageContext":{}},"staticQueryHashes":["2272393477","3649515864"]}