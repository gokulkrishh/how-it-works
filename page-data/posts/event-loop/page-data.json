{"componentChunkName":"component---src-templates-issue-template-js","path":"/posts/event-loop","result":{"data":{"markdownRemark":{"html":"<p>Before we learn about the event loop. I want to talk about javascript first to understand event loop better.</p>\n<p>Javascript is <strong>interpreted</strong> programming language meaning the source code is not compiled until the time of execution. But how does a machine understands the non-compiled code? Well, that is taken care of by <strong>javascript engine</strong> which is responsible for <strong>compiling</strong> the javascript code to <strong>machine code</strong>.</p>\n<h5>In javascript, there are <strong>blocking</strong> &#x26; <strong>non-blocking</strong> operations:</h5>\n<ul>\n<li><strong>Blocking</strong> is when the execution of code has to wait until the execution of an operation is completed (<strong>synchronous</strong>).</li>\n<li><strong>Non-blocking</strong> when execution happens <strong>asynchronously</strong> and doesn't not have to wait for some other operation to complete.</li>\n<li><strong>I/O operations</strong> such as <strong>HTTP requests</strong>, <strong>disk read/write</strong> are <strong>non-blocking</strong> in javascript.</li>\n</ul>\n<h4>üëâüèª Points to remember:</h4>\n<ul>\n<li>Each browser has a javascript <strong>runtime environment</strong>.</li>\n<li><strong>Javascript engine</strong> &#x26; <strong>Event loop</strong> is a part of javascript <strong>runtime environment</strong>.</li>\n<li><strong>Javascript engine</strong> is <a href=\"https://en.wikipedia.org/wiki/Thread_(computing)#Single_threading\">single-threaded</a> and it can <strong>execute one piece of code at a time</strong>.</li>\n<li><strong>Event loop</strong> is a <strong>concurrent model</strong> responsible for executing the <strong>javascript code</strong>.</li>\n</ul>\n<h4>Illustration:</h4>\n<p style=\"margin: 0 auto;\">\n <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 80.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAADbklEQVQoz02T7U9TdxTHz73IwpPJ6mZRdJkhe2uyFyYCS3xJ4hIXAqvpXvgPsPCi7g1rbLKUpFSELlHDIlrKQyjbAtpH+3QBS+wqrkgRykorfb6XtveWdghSSh92ri7qycnJefH75Ps9J+cHCoVCp9NNT093dHS0t7d//zZEIpFYLO7q6sLmKgZWkegHsfjby5e/u3Lld6320eysXC6Hqampcrmcz+e7u7s7Ozt7e3ulUqlEIpHJZD09PT9dv/6zVPqLQiFXKpVDQ+Jr136USIoVPkY1GpiYmGAYZmVlxefzuVwup9O5sLCwtbUVexeJxObLl7bBQVN/v/3u3Sdq9V+jo5RK5Varh+/cgcnJyWw26/f7l5eXPR7P+vp6IBDgOC6X29nh0q8P32w/f/aors4A8PT0aXdzs+348VkAh1A4rFTC+Ph4KpWKRqPptxGPxzOZDMIsm+XS2Ribo6knyfqGNwAHBHEEUCGIMtbGxgc3b/LwxsbG6uoqAmhzbW0tFAphT9Ov6LgvkgzGKUOovj4KkCTJPZKskGQRYaGQhzUaTTgcxoFRM8FHnKbTu7vhXO7rV4GmBPdVyXc2VE+keE1AzTJBlD6GcT0oiDDLssnkNsPgwP7DgpBlYSdPlP6BaAMRAyJcRURIIkYSQYC9U0L1Oxh9IkzTNOoyTCIaYf7dDXBsMx2pTWY+PXxRwzUAKqcIvm4fq+aAqJw8+QHGJaM+mt/c9G+FEhnW6w02DT4ElaH6/sNP5m6ftQ81WYdOmZSCPxXn7slA2/fNr6rb/9v2er24JDyVvb3XBf4IkmP0GZitqtLVkFTt595zJ7xfCla+qPu7sfbpCVgCwfpnN4ZlMDY2hsqoub+/jxBeW7FSqhxUfsvKIQE16Woyi46BSAIwAGmo2ibhAAQVgWz0Bq+MF2Y2m3HsYrGIlc2w6Qg7lfjjPHO+Ndp6MX6xJdbSGmttC7W10C1t4bYLkQuXypf6HvTBwMDA/Pw8foyRkZGZmRm1Wm0wGOx2u2POZp2zPnY8tlAWbEx2E582k9FmxLTarYp+BSCAblETK54abg6bYCC49HzJ5XYFggH3M7fnhadQLByVjvgsHuULeXyjndaCSqVaXFx0OBwUReGXMBqNaMRisej1ep1BZ7aa9UY9JjVHvU8H5XAuOm8N3voPx31g11jPDjQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Javascript runtime environment\" title=\"Javascript runtime environment\" src=\"/static/76d5a5bca2c321564bc60ed62b24f141/fcda8/js-runtime.png\" srcset=\"/static/76d5a5bca2c321564bc60ed62b24f141/12f09/js-runtime.png 148w,\n/static/76d5a5bca2c321564bc60ed62b24f141/e4a3f/js-runtime.png 295w,\n/static/76d5a5bca2c321564bc60ed62b24f141/fcda8/js-runtime.png 590w,\n/static/76d5a5bca2c321564bc60ed62b24f141/8c557/js-runtime.png 700w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n <i class=\"image__illustration\"><a href=\"https://medium.com/@olinations/the-javascript-runtime-environment-d58fa2e60dd0\" target=\"_blank\">Source: Medium</a></i>\n</p>\n<h4>Javascript runtime consists of:</h4>\n<ul>\n<li><strong>Call stack</strong> - Execute the code one at a time.</li>\n<li><strong>Event loop</strong> - Check if the call stack is empty if so pull the callback from the queue and add it to stack.</li>\n<li><strong>Callback queue</strong> - Callbacks are pushed into the callback queue.</li>\n<li><strong>Web API's</strong> - Talk to the browser via javascript.</li>\n</ul>\n<p><strong>Illustration of javascript runtime</strong>:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 95.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAAA+0lEQVQ4y7VT7Y7CIBDs+7+Qb9J45gwxptdTiJbCUhWWlfXj0tba9JI62fADGHbZ2cmsMRxP1HVdVZWdAGNMBgDUgvdeKUUTkIizkGPkeEe+n94uzJ7ZAYGh4H0IA+R0qo98YYCMGDZrXC+jPnqMSslOwUS4L1GscFe0N+cqe5z8yYaNS/WOnAatl1lK+Y/MBsAqZYXgeU3DrbWdhizpxO/kOS0WsSyC+MLvPMrfP0lGkD0slZxUljaVAO62wsNtXc/1XdX783R0u32v/yksFhueqq3Any2F8Ep2zvV1br1sSB/IaI6hz3Pm1F03iNPJXS7ufOZ4QdM0iXgFhnpZ/LW72XYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Javascript runtime illustration\" title=\"Javascript runtime illustration\" src=\"/static/e941128e735a22c5aa2db41453bd9322/fcda8/event-loop.png\" srcset=\"/static/e941128e735a22c5aa2db41453bd9322/12f09/event-loop.png 148w,\n/static/e941128e735a22c5aa2db41453bd9322/e4a3f/event-loop.png 295w,\n/static/e941128e735a22c5aa2db41453bd9322/fcda8/event-loop.png 590w,\n/static/e941128e735a22c5aa2db41453bd9322/efc66/event-loop.png 885w,\n/static/e941128e735a22c5aa2db41453bd9322/c83ae/event-loop.png 1180w,\n/static/e941128e735a22c5aa2db41453bd9322/cb425/event-loop.png 1678w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n<i class=\"image__illustration\">(Illustration of js runtime)</i>\n<h3>Call Stack:</h3>\n<p>Call stack in javascript can do <strong>one only thing at time</strong>. Call stack is simple <strong>stack</strong> (<strong>LIFO</strong>) based <strong>data structure</strong> which executes by pushing code on <strong>top of the stack</strong> and <strong>popping it off</strong> from the top once execution is done.</p>\n<p><strong>Example</strong>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber 0\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"gatsby-highlight-code-line\">  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"baz\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"outside\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>Output</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 1. print outside</span>\n<span class=\"token comment\">// 2. print foo</span>\n<span class=\"token comment\">// 3. print baz</span></code></pre></div>\n<h4>Demo:</h4>\n<div class=\"demo-iframe\">\n<i style=\"color: #000;display: block;\">Close the modal dialogue and click save + run button</i>\n<iframe src=\"https://latentflip.com/loupe/?code=ZnVuY3Rpb24gZm9vKCkgewogIGNvbnNvbGUubG9nKCJmb28iKTsKfQoKZnVuY3Rpb24gYmF6KCkgewogIGZvbygpOwoKICBjb25zb2xlLmxvZygiYmF6Iik7Cn0KCmNvbnNvbGUubG9nKCJvdXRzaWRlIik7CgpiYXooKTs%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D\">\n</iframe>\n<a target=\"_blank\" href=\"https://latentflip.com/loupe/?code=ZnVuY3Rpb24gZm9vKCkgewogIGNvbnNvbGUubG9nKCJmb28iKTsKfQoKZnVuY3Rpb24gYmF6KCkgewogIGZvbygpOwoKICBjb25zb2xlLmxvZygiYmF6Iik7Cn0KCmNvbnNvbGUubG9nKCJvdXRzaWRlIik7CgpiYXooKTs%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D\"><i class=\"image__illustration\">(Call stack demo)</i></a>\n</div>\n<p><strong>Explanation of code execution:</strong></p>\n<ol>\n<li>Add <code class=\"language-text\">console.log(&#39;outside&#39;)</code> to <strong>top</strong> of the stack and <strong>execute</strong> and <strong>pop it off</strong>.</li>\n<li>Add <code class=\"language-text\">baz()</code> function call to <strong>top</strong> of the stack and <strong>execute</strong> it.</li>\n<li>Add <code class=\"language-text\">foo()</code> function call to <strong>top</strong> of the stack and <strong>execute</strong> it.</li>\n<li>Add <code class=\"language-text\">console.log(&quot;foo&quot;)</code> to <strong>top</strong> of the stack and <strong>execute</strong> it and <strong>pop it off</strong>.</li>\n<li>Then <strong>pop</strong> <code class=\"language-text\">foo()</code> function from the stack.</li>\n<li>Add <code class=\"language-text\">console.log(&quot;baz&quot;)</code> to <strong>top</strong> of the stack and <strong>execute</strong> and <strong>pop it off</strong>.</li>\n<li>Then <strong>pop</strong> <code class=\"language-text\">baz()</code> function from the stack.</li>\n</ol>\n<h3>Event loop:</h3>\n<p>The event loop's job is quite simple, <strong>constantly check if the call stack is empty or not</strong>. If empty then <strong>pull the callback</strong> from the callback queue and <strong>put it</strong> on <strong>top the stack</strong> for execution.</p>\n<h3>Callback queue:</h3>\n<p>Callback queue is a simple <strong>queue-based</strong> data structure (<strong>FIFO</strong>). This is where all <strong>asynchronous code</strong> is pushed to. From here event loop will take over and push the <strong>queued callbacks</strong> to <strong>call stack</strong>.</p>\n<p>Callback queue is the reason that I/O events are non-blocking.</p>\n<h3>Web API's:</h3>\n<p>Web API's also known as <strong>Browser Object Model</strong> (BOM) is the API's that allows javascript <strong>to talk</strong> to <strong>web browsers</strong>.</p>\n<p><strong>Some web API's</strong>:</p>\n<ul>\n<li>Window object</li>\n<li>Window location</li>\n<li>Navigator (information about user's browser)</li>\n<li>Cookies</li>\n<li>Timing Events such as setTimeout, setInterval, etc,</li>\n</ul>\n<p>Let us see an example of how web API works in the event loop. If you are a javascript developer I am sure you would have used setTimeout or setInterval.\nSo let's take that as an example.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber 0\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4>Demo:</h4>\n<div class=\"demo-iframe\">\n<i style=\"color: #000;display: block;\">Close the modal dialogue and click save + run button</i>\n<iframe src=\"https://latentflip.com/loupe/?code=ZnVuY3Rpb24gZm9vKCkgewogIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmxvZygiZm9vIik7CiAgfSwgMjAwMCk7Cn0KCmZvbygpOw%3D%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D\">\n</iframe>\n<a target=\"_blank\" href=\"https://latentflip.com/loupe/?code=ZnVuY3Rpb24gZm9vKCkgewogIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmxvZygiZm9vIik7CiAgfSwgMjAwMCk7Cn0KCmZvbygpOw%3D%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D\"><i class=\"image__illustration\">(setTimeout demo)</i></a>\n</div>\n<p><strong>Explanation of code execution:</strong></p>\n<ol>\n<li>Add <code class=\"language-text\">foo()</code> to <strong>top</strong> of the stack and <strong>execute</strong> it.</li>\n<li>Add <code class=\"language-text\">setTimeout()</code> with callback to <strong>top</strong> of the stack and <strong>execute</strong> it and pop it off.</li>\n<li><code class=\"language-text\">Timer</code> will be keeping track and executed inside the browser.</li>\n<li>Add setTimeout <code class=\"language-text\">callback</code> to <strong>callback queue</strong>.</li>\n<li><strong>Event loop</strong> will pull the timer <code class=\"language-text\">callback</code> from <strong>queue</strong> and add to the <code class=\"language-text\">top of stack</code>.</li>\n<li>Add <code class=\"language-text\">console.log()</code> to stack and <strong>execute it</strong> and <strong>pop it off</strong>.</li>\n<li>Finally pop function <code class=\"language-text\">foo()</code> from the stack.</li>\n</ol>\n<h3>Final note</h3>\n<p>I hope in this post you have learned a little bit more about javascript and its runtime. The examples I showed are more of an abstract idea of the event loop and browser vendors would have implemented the event loop with a lot of optimizations but you get the idea right how it works. For the sake of this post I have skipped writing about <strong>micro tasks</strong> in event loop. For more <a href=\"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/\">read here</a>.</p>\n<p>I want to thank <a href=\"https://twitter.com/philip_roberts\">Philip Roberts</a> for creating <a href=\"http://latentflip.com/loupe\">loupe</a> an awesome tool to visualize how event loops work.</p>\n<p>Thanks for reading it so far. See ya in the next post.</p>\n<h4>References:</h4>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop\">MDN EventLoop</a></li>\n<li><a href=\"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/\">Tasks, microtasks, queues and schedules</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=8aGhZQkoFbQ\">What the heck is event loop?</a></li>\n</ul>","frontmatter":{"date":"April 28, 2020","path":"/posts/event-loop","published":true,"title":"Event Loop","description":"Event loop in javascript is a concurrent model which is responsible for executing the code.","tags":["javascript","event loop"]}}},"pageContext":{}},"staticQueryHashes":["2272393477","3649515864"]}